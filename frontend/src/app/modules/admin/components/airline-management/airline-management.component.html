<div class="airline-management">
    <div class="page-header">
        <div class="header-content">
            <h1>
                <mat-icon>flight</mat-icon>
                Gestione Compagnie Aeree
            </h1>
            <p>Amministra le compagnie aeree registrate sulla piattaforma</p>
        </div>
        <div class="header-actions">
            <button class="btn-primary" (click)="openInviteDialog()">
                <mat-icon>add</mat-icon>
                Invita Compagnia
            </button>
        </div>
    </div>

    <!-- Search and Filters -->
    <mat-card class="filters-card">
        <mat-card-content>
            <div class="filters-grid">
                <mat-form-field appearance="outline">
                    <mat-label>Cerca compagnie...</mat-label>
                    <input matInput [(ngModel)]="searchTerm" (input)="onSearch($event)"
                        placeholder="Nome, codice o email">
                    <mat-icon matSuffix>search</mat-icon>
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Filtra per paese</mat-label>
                    <mat-select [(value)]="selectedCountry" (selectionChange)="onFilterChange()">
                        <mat-option value="">Tutti i paesi</mat-option>
                        <mat-option value="Italy">Italia</mat-option>
                        <mat-option value="France">Francia</mat-option>
                        <mat-option value="Germany">Germania</mat-option>
                        <mat-option value="Spain">Spagna</mat-option>
                        <mat-option value="United Kingdom">Regno Unito</mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Filtra per stato</mat-label>
                    <mat-select [(value)]="selectedStatus" (selectionChange)="onFilterChange()">
                        <mat-option value="">Tutti gli stati</mat-option>
                        <mat-option value="active">Attive</mat-option>
                        <mat-option value="inactive">Inattive</mat-option>
                    </mat-select>
                </mat-form-field>

                <div class="filter-actions">
                    <button class="btn-secondary" (click)="clearFilters()">
                        <mat-icon>clear</mat-icon>
                        Pulisci Filtri
                    </button>
                </div>
            </div>
        </mat-card-content>
    </mat-card>

    <!-- Error Message -->
    <div class="status-message error" *ngIf="error && !loading">
        <mat-icon>error</mat-icon>
        <span>{{ error }}</span>
    </div>

    <!-- Airlines Table -->
    <mat-card class="airlines-table-card" *ngIf="!loading; else loadingTemplate">
        <mat-card-header>
            <mat-card-title>
                <mat-icon>flight_takeoff</mat-icon>
                Compagnie Aeree Registrate
            </mat-card-title>
            <mat-card-subtitle>{{ totalAirlines }} compagnie trovate</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
            <div class="table-container" *ngIf="airlines.length > 0; else emptyTemplate">
                <table mat-table [dataSource]="airlines" class="airlines-table">

                    <!-- Code Column -->
                    <ng-container matColumnDef="code">
                        <th mat-header-cell *matHeaderCellDef>Codice IATA</th>
                        <td mat-cell *matCellDef="let airline">
                            <div class="airline-code">{{ airline.code }}</div>
                        </td>
                    </ng-container>

                    <!-- Name Column -->
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef>Nome Compagnia</th>
                        <td mat-cell *matCellDef="let airline">
                            <div class="airline-info">
                                <div class="airline-name">{{ airline.name }}</div>
                                <div class="airline-contact">{{ airline.contactEmail }}</div>
                            </div>
                        </td>
                    </ng-container>

                    <!-- Country Column -->
                    <ng-container matColumnDef="country">
                        <th mat-header-cell *matHeaderCellDef>Paese</th>
                        <td mat-cell *matCellDef="let airline">
                            <div class="country-info">
                                <mat-icon>flag</mat-icon>
                                {{ airline.country }}
                            </div>
                        </td>
                    </ng-container>

                    <!-- Contact Email Column -->
                    <ng-container matColumnDef="contactEmail">
                        <th mat-header-cell *matHeaderCellDef>Contatto</th>
                        <td mat-cell *matCellDef="let airline">
                            <div class="contact-info">
                                <div class="contact-name">{{ airline.userId.firstName }} {{ airline.userId.lastName }}
                                </div>
                                <div class="contact-email">{{ airline.contactEmail }}</div>
                            </div>
                        </td>
                    </ng-container>

                    <!-- Status Column -->
                    <ng-container matColumnDef="isActive">
                        <th mat-header-cell *matHeaderCellDef>Stato</th>
                        <td mat-cell *matCellDef="let airline">
                            <mat-chip [color]="getStatusColor(airline.isActive)" selected>
                                {{ getStatusText(airline.isActive) }}
                            </mat-chip>
                        </td>
                    </ng-container>

                    <!-- Created At Column -->
                    <ng-container matColumnDef="createdAt">
                        <th mat-header-cell *matHeaderCellDef>Registrata il</th>
                        <td mat-cell *matCellDef="let airline">
                            {{ airline.createdAt | date:'short':'it-IT' }}
                        </td>
                    </ng-container>

                    <!-- Actions Column -->
                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef>Azioni</th>
                        <td mat-cell *matCellDef="let airline">
                            <div class="action-buttons">
                                <button mat-icon-button color="primary" (click)="viewAirlineDetails(airline)"
                                    matTooltip="Visualizza dettagli">
                                    <mat-icon>visibility</mat-icon>
                                </button>
                                <button mat-icon-button [color]="airline.isActive ? 'warn' : 'primary'"
                                    (click)="toggleAirlineStatus(airline)"
                                    [matTooltip]="airline.isActive ? 'Disattiva' : 'Attiva'">
                                    <mat-icon>{{ airline.isActive ? 'block' : 'check' }}</mat-icon>
                                </button>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>
            </div>

            <!-- Empty State -->
            <ng-template #emptyTemplate>
                <div class="empty-state">
                    <mat-icon>flight_off</mat-icon>
                    <h3>Nessuna compagnia aerea trovata</h3>
                    <p>Non ci sono compagnie aeree che corrispondono ai filtri selezionati</p>
                    <button class="btn-primary" (click)="openInviteDialog()">
                        <mat-icon>add</mat-icon>
                        Invita Prima Compagnia
                    </button>
                </div>
            </ng-template>
        </mat-card-content>
    </mat-card>

    <!-- Loading Template -->
    <ng-template #loadingTemplate>
        <div class="loading-container">
            <mat-spinner diameter="50"></mat-spinner>
            <p>Caricamento compagnie aeree...</p>
        </div>
    </ng-template>
</div>