<div class="admin-dashboard">
  <div class="dashboard-header">
    <h1>Dashboard Amministratore</h1>
    <p>Gestisci utenti, compagnie aeree e sistema</p>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="refreshData()">
        <mat-icon>refresh</mat-icon>
        Aggiorna
      </button>
      <button mat-raised-button (click)="exportSystemReport()">
        <mat-icon>download</mat-icon>
        Report Sistema
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Caricamento dashboard...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !loading">
    <mat-icon>error</mat-icon>
    <span>{{ error }}</span>
    <button mat-raised-button color="primary" (click)="refreshData()">Riprova</button>
  </div>

  <div class="dashboard-content" *ngIf="!loading && !error && dashboardStats">
    <!-- Dashboard Statistics -->
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>people</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalUsers }}</h3>
            <p>Utenti Totali</p>
            <span class="stat-subtitle">{{ dashboardStats.newUsersThisMonth }} nuovi questo mese</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>business</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalAirlines }}</h3>
            <p>Compagnie Aeree</p>
            <span class="stat-subtitle">{{ dashboardStats.activeAirlines }} attive</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>flight</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalFlights }}</h3>
            <p>Voli Totali</p>
            <span class="stat-subtitle">{{ dashboardStats.activeFlights }} programmati</span>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>confirmation_number</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ dashboardStats.totalBookings }}</h3>
            <p>Prenotazioni</p>
            <span class="stat-subtitle">{{ dashboardStats.bookingsThisMonth }} questo mese</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2>Azioni Rapide</h2>
      <div class="actions-grid">
        <mat-card class="action-card" routerLink="/admin/users">
          <mat-card-content>
            <mat-icon>people</mat-icon>
            <h3>Gestione Utenti</h3>
            <p>Gestisci utenti e invita compagnie aeree</p>
          </mat-card-content>
        </mat-card>

        <mat-card class="action-card" routerLink="/admin/airlines">
          <mat-card-content>
            <mat-icon>flight</mat-icon>
            <h3>Gestione Compagnie</h3>
            <p>Invita e gestisci compagnie aeree</p>
          </mat-card-content>
        </mat-card>

        <mat-card class="action-card" routerLink="/admin/routes">
          <mat-card-content>
            <mat-icon>alt_route</mat-icon>
            <h3>Gestione Rotte</h3>
            <p>Gestisci rotte aeree del sistema</p>
          </mat-card-content>
        </mat-card>

        <mat-card class="action-card" (click)="exportUsers()">
          <mat-card-content>
            <mat-icon>download</mat-icon>
            <h3>Esporta Utenti</h3>
            <p>Scarica lista utenti in CSV</p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>flight</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ totalFlights }}</h3>
            <p>Voli Totali</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>flight_takeoff</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ activeFlights }}</h3>
            <p>Voli Attivi</p>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>business</mat-icon>
          </div>
          <div class="stat-info">
            <h3>{{ totalAirlines }}</h3>
            <p>Compagnie Aeree</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Recent Flights -->
    <mat-card class="data-card">
      <mat-card-header>
        <mat-card-title>Voli Recenti</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="table-container">
          <table mat-table [dataSource]="flights.slice(0, 10)" class="flights-table">
            <!-- Flight Number Column -->
            <ng-container matColumnDef="flightNumber">
              <th mat-header-cell *matHeaderCellDef>Volo</th>
              <td mat-cell *matCellDef="let flight">{{ flight.flightNumber }}</td>
            </ng-container>

            <!-- Airline Column -->
            <ng-container matColumnDef="airline">
              <th mat-header-cell *matHeaderCellDef>Compagnia</th>
              <td mat-cell *matCellDef="let flight">{{ flight.airline?.name || 'N/A' }}</td>
            </ng-container>

            <!-- Route Column -->
            <ng-container matColumnDef="route">
              <th mat-header-cell *matHeaderCellDef>Rotta</th>
              <td mat-cell *matCellDef="let flight">
                {{ flight.departureAirport?.code }} → {{ flight.arrivalAirport?.code }}
              </td>
            </ng-container>

            <!-- Departure Column -->
            <ng-container matColumnDef="departure">
              <th mat-header-cell *matHeaderCellDef>Partenza</th>
              <td mat-cell *matCellDef="let flight">
                {{ flight.departureTime | date:'dd/MM/yyyy HH:mm' }}
              </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Stato</th>
              <td mat-cell *matCellDef="let flight">
                <mat-chip [color]="getFlightStatusColor(flight.status)" selected>
                  {{ getFlightStatusText(flight.status) }}
                </mat-chip>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['flightNumber', 'airline', 'route', 'departure', 'status']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['flightNumber', 'airline', 'route', 'departure', 'status'];">
            </tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>


    <!-- System Statistics -->
    <div class="system-stats" *ngIf="systemStats">
      <h2>Statistiche di Sistema</h2>
      <div class="system-stats-grid">
        <mat-card class="system-stat-card">
          <mat-card-content>
            <h3>Performance</h3>
            <div class="stat-item">
              <span>Tempo di risposta medio:</span>
              <strong>{{ systemStats.averageResponseTime }}ms</strong>
            </div>
            <div class="stat-item">
              <span>Uptime:</span>
              <strong>{{ systemStats.systemUptime }}</strong>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="system-stat-card">
          <mat-card-content>
            <h3>Database</h3>
            <div class="stat-item">
              <span>Dimensione database:</span>
              <strong>{{ systemStats.databaseSize }}</strong>
            </div>
            <div class="stat-item">
              <span>Backup più recente:</span>
              <strong>{{ systemStats.lastBackup | date: 'dd/MM/yyyy HH:mm' }}</strong>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="system-stat-card">
          <mat-card-content>
            <h3>Errori</h3>
            <div class="stat-item">
              <span>Errori oggi:</span>
              <strong>{{ systemStats.errorsToday }}</strong>
            </div>
            <div class="stat-item">
              <span>Tasso di successo:</span>
              <strong>{{ systemStats.successRate }}%</strong>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </div>
</div>